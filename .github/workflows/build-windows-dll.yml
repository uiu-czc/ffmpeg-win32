name: Build FFmpeg Info DLL (x86)

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build_windows_dll_x86:
    runs-on: windows-latest
    
    steps:
      - name: â¬‡ï¸ Checkout Repository
        uses: actions/checkout@v4
        
      - name: ğŸ› ï¸ Install vcpkg (x86)
        uses: lukka/run-vcpkg@v11
        with:
          # *** å…³é”®ä¿®æ”¹ 1: æŒ‡å®š vcpkg ä¸‰å…ƒç»„ä¸º x86-windows ***
          vcpkgArguments: 'ffmpeg:x86-windows-static'
          
      - name: âš™ï¸ Configure CMake (x86)
        shell: powershell
        run: |
          # *** å…³é”®ä¿®æ”¹ 2: æŒ‡å®š CMake ç”Ÿæˆå™¨ä¸º Win32 (Visual Studio 2022) ***
          # æ³¨æ„ï¼šVisual Studio 2022 æˆ– 2019 é»˜è®¤å®‰è£…äº† 32 ä½å·¥å…·é“¾ã€‚
          cmake -B build `
            -DCMAKE_BUILD_TYPE=Release `
            -DCMAKE_TOOLCHAIN_FILE=$env:VCPKG_ROOT\scripts\buildsystems\vcpkg.cmake `
            -A Win32 # æŒ‡å®šç›®æ ‡æ¶æ„ä¸º 32 ä½
        
      - name: ğŸ—ï¸ Build DLL (x86)
        # --config Release æ˜¯å¿…é¡»çš„ï¼Œå› ä¸ºæˆ‘ä»¬ä½¿ç”¨äº†å¤šé…ç½®ç”Ÿæˆå™¨ (Visual Studio)
        run: cmake --build build --config Release
        
      - name: ğŸ“¦ Upload DLL Artifact
        uses: actions/upload-artifact@v4
        with:
          name: AVStreamInfoExtractor-DLL-Win32
          path: build/Release/AVStreamInfoExtractor.dll # è·¯å¾„ä¿æŒä¸å˜
          
      - name: ğŸ“ Show Build Details
        run: |
          echo "å·²æˆåŠŸæ„å»º 32 ä½ (Win32) DLLã€‚"
          # å¯ä»¥ä½¿ç”¨ dumpbin /HEADERS æˆ– sigcheck ç­‰å·¥å…·éªŒè¯æ–‡ä»¶æ¶æ„